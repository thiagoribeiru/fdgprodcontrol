<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Produ√ß√£o</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè≠</text></svg>">
</head>
<body>
    <div class="title-container">
        <h1>PROCESSO ATUAL POR PEDIDOS</h1>
        <div>
            <button class="add-button" onclick="openAddPedidoModal()">Adicionar Pedido</button>
            <button class="add-button" onclick="openItensModal()">Gerenciar Itens</button>
            <button class="add-button" onclick="openProcessosModal()">Gerenciar Processos</button>
        </div>
    </div>

    <table class="tablePedidos" id="tablePedidos">
        <thead>
            <tr>
                <th>DATA ENTRADA</th>
                <th>DATA ENTREGA</th>
                <th>PEDIDO</th>
                <th>CLIENTE</th>
                <th>PROCESSO</th>
                <th>ITENS</th>
                <th>A√á√ïES</th>
            </tr>
        </thead>
        <tbody id="pedidosTableBody">
            <!-- Dados ser√£o carregados via JavaScript -->
        </tbody>
    </table>

    <!-- Modal Adicionar Pedido -->
    <div id="addPedidoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Adicionar Novo Pedido</h2>
                <span class="close" onclick="closeAddPedidoModal()">&times;</span>
            </div>
            
            <form id="addPedidoForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="dataEntrada">Data de Entrada:</label>
                        <input type="date" id="dataEntrada" name="dataEntrada" required>
                    </div>
                    <div class="form-group">
                        <label for="dataEntrega">Data de Entrega:</label>
                        <input type="date" id="dataEntrega" name="dataEntrega" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="codigoPedido">C√≥digo do Pedido:</label>
                        <input type="text" id="codigoPedido" name="codigoPedido" required>
                    </div>
                    <div class="form-group">
                        <label for="cliente">Cliente:</label>
                        <input type="text" id="cliente" name="cliente" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="processoAtual">Processo Atual:</label>
                    <select id="processoAtual" name="processoAtual" required>
                        <option value="">Selecione o processo</option>
                        <option value="corte">Corte</option>
                        <option value="personaliza√ß√£o">Personaliza√ß√£o</option>
                        <option value="produ√ß√£o">Produ√ß√£o</option>
                        <option value="expedi√ß√£o">Expedi√ß√£o</option>
                    </select>
                </div>

                <div class="itens-section">
                    <div class="section-header">
                        <h3>Itens do Pedido</h3>
                        <button type="button" class="add-button small" onclick="openSelectItemModal()">Adicionar Item</button>
                    </div>
                    
                    <table class="table-itens" id="pedidoItensTable">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Quantidade</th>
                                <th>Observa√ß√µes</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="pedidoItensBody">
                            <!-- Itens ser√£o adicionados aqui -->
                        </tbody>
                    </table>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-cancel" onclick="closeAddPedidoModal()">Cancelar</button>
                    <button type="submit" class="btn-save">Salvar Pedido</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Selecionar Item -->
    <div id="selectItemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Selecionar Item</h2>
                <span class="close" onclick="closeSelectItemModal()">&times;</span>
            </div>
            
            <table class="tablePedidos" id="selectItemTable">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Descri√ß√£o</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="selectItemBody">
                    <!-- Itens ser√£o carregados aqui -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal Adicionar Item ao Pedido -->
    <div id="addItemToPedidoModal" class="modal">
        <div class="modal-content small">
            <div class="modal-header">
                <h2>Adicionar Item ao Pedido</h2>
                <span class="close" onclick="closeAddItemToPedidoModal()">&times;</span>
            </div>
            
            <form id="addItemToPedidoForm">
                <input type="hidden" id="selectedItemId">
                <div class="form-group">
                    <label id="selectedItemName"></label>
                </div>
                <div class="form-group">
                    <label for="itemQuantidade">Quantidade:</label>
                    <input type="number" id="itemQuantidade" name="quantidade" min="1" value="1" required>
                </div>
                <div class="form-group">
                    <label for="itemObservacoes">Observa√ß√µes:</label>
                    <textarea id="itemObservacoes" name="observacoes" rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-cancel" onclick="closeAddItemToPedidoModal()">Cancelar</button>
                    <button type="submit" class="btn-save">Adicionar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Gerenciar Itens -->
    <div id="itensModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Gerenciar Itens</h2>
                <span class="close" onclick="closeItensModal()">&times;</span>
            </div>
            
            <div class="tabs">
                <button class="tab-button active" onclick="showTab('listar-itens')">Listar Itens</button>
                <button class="tab-button" onclick="showTab('adicionar-item')">Adicionar Item</button>
            </div>

            <div id="listar-itens" class="tab-content active">
                <table class="tablePedidos" id="itensTable">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Descri√ß√£o</th>
                            <th>Processos</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="itensTableBody">
                        <!-- Itens ser√£o carregados aqui -->
                    </tbody>
                </table>
            </div>

            <div id="adicionar-item" class="tab-content">
                <form id="addItemForm">
                    <div class="form-group">
                        <label for="itemNome">Nome do Item:</label>
                        <input type="text" id="itemNome" name="nome" required>
                    </div>
                    <div class="form-group">
                        <label for="itemDescricao">Descri√ß√£o:</label>
                        <textarea id="itemDescricao" name="descricao" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn-save">Adicionar Item</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Gerenciar Processos do Item -->
    <div id="itemProcessosModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="itemProcessosTitle">Processos do Item</h2>
                <span class="close" onclick="closeItemProcessosModal()">&times;</span>
            </div>
            
            <!-- Informa√ß√£o sobre ordem global -->
            <div class="info-box ordem-global-info">
                <h4>üåê Ordem Global dos Processos</h4>
                <p>Os processos seguem automaticamente a <strong>ordem global</strong> definida no sistema. N√£o √© necess√°rio definir ordem espec√≠fica para cada item.</p>
            </div>
            
            <div class="section-header">
                <h3>Adicionar Processo</h3>
            </div>
            
            <form id="addItemProcessoForm">
                <input type="hidden" id="currentItemId">
                
                <div class="form-group">
                    <label for="processoSelect">Processo:</label>
                    <select id="processoSelect" name="processo_id" required>
                        <option value="">Selecione o processo</option>
                    </select>
                    <small class="field-hint">üí° A ordem ser√° definida automaticamente pela sequ√™ncia global dos processos</small>
                </div>
                
                <div class="form-group">
                    <label for="processoObservacoes">Observa√ß√µes:</label>
                    <textarea id="processoObservacoes" name="observacoes" rows="2" placeholder="Observa√ß√µes espec√≠ficas para este processo neste item"></textarea>
                </div>
                
                <button type="submit" class="btn-save">Adicionar Processo</button>
            </form>

            <div class="section-header">
                <h3>Processos Configurados</h3>
            </div>
            
            <table class="tablePedidos" id="itemProcessosTable">
                <thead>
                    <tr>
                        <th>Ordem Global</th>
                        <th>Processo</th>
                        <th>Observa√ß√µes</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="itemProcessosBody">
                    <!-- Processos ser√£o carregados aqui -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal Gerenciar Processos -->
    <div id="processosModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Gerenciar Processos</h2>
                <span class="close" onclick="closeProcessosModal()">&times;</span>
            </div>
            
            <div class="tabs">
                <button class="tab-button active" onclick="showTab('listar-processos')">Listar Processos</button>
                <button class="tab-button" onclick="showTab('adicionar-processo')">Adicionar Processo</button>
                <button class="tab-button" onclick="showTab('verificar-ordem')">Verificar Ordem</button>
            </div>

            <div id="listar-processos" class="tab-content active">
                <div class="info-box reorganizacao-info">
                    <h4>üîÑ Reorganiza√ß√£o Autom√°tica</h4>
                    <p><strong>üí° Como funciona:</strong> Quando voc√™ escolhe uma ordem j√° ocupada por outro processo, todos os processos com ordem igual ou superior s√£o automaticamente renumerados para manter a sequ√™ncia correta.</p>
                </div>

                <table class="tablePedidos" id="processosTable">
                    <thead>
                        <tr>
                            <th>Ordem</th>
                            <th>Nome</th>
                            <th>Descri√ß√£o</th>
                            <th>Uso</th>
                            <th>Tipo</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="processosTableBody">
                        <!-- Processos ser√£o carregados aqui -->
                    </tbody>
                </table>
            </div>

            <div id="adicionar-processo" class="tab-content">
                <div class="info-box warning-info">
                    <p><strong>üí° Dica:</strong> Se voc√™ escolher uma ordem j√° existente, os processos ser√£o reorganizados automaticamente. Deixe em branco para adicionar no final da sequ√™ncia.</p>
                </div>

                <form id="addProcessoForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="processoNome">Nome do Processo:</label>
                            <input type="text" id="processoNome" name="nome" required>
                        </div>
                        <div class="form-group ordem-input-container">
                            <label for="processoOrdem">Ordem:</label>
                            <input type="number" id="processoOrdem" name="ordem" min="1" placeholder="Autom√°tico se vazio">
                            <div id="ordemFeedback" class="ordem-feedback"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="processoDescricao">Descri√ß√£o:</label>
                        <textarea id="processoDescricao" name="descricao" rows="3" placeholder="Descri√ß√£o opcional do processo"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn-save">Adicionar Processo</button>
                    </div>
                </form>
            </div>

            <div id="verificar-ordem" class="tab-content">
                <div class="verification-container">
                    <h3>üîç Verifica√ß√£o da Ordem dos Processos</h3>
                    
                    <p>Esta ferramenta verifica se h√° problemas na numera√ß√£o dos processos e oferece corre√ß√£o autom√°tica.</p>
                    
                    <div class="verification-buttons">
                        <button class="btn-save" onclick="verificarOrdemProcessos()">üîç Verificar Ordem dos Processos</button>
                    </div>
                    
                    <div id="resultadoVerificacao" class="verification-result"></div>
                    
                    <div class="info-box verification-info">
                        <h4>‚ÑπÔ∏è Sobre a Verifica√ß√£o</h4>
                        <ul>
                            <li><strong>Ordens Duplicadas:</strong> Quando dois ou mais processos t√™m a mesma ordem</li>
                            <li><strong>Corre√ß√£o Autom√°tica:</strong> Renumera todos os processos em sequ√™ncia (1, 2, 3...)</li>
                            <li><strong>Preserva√ß√£o da Ordem:</strong> Mant√©m a ordem relativa baseada na ordem atual</li>
                            <li><strong>Seguran√ßa:</strong> Opera√ß√£o revers√≠vel que n√£o afeta dados dos pedidos</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Processo -->
    <div id="editProcessoModal" class="modal">
        <div class="modal-content small">
            <div class="modal-header">
                <h2>Editar Processo</h2>
                <span class="close" onclick="closeEditProcessoModal()">&times;</span>
            </div>
            
            <div class="info-box reorganizacao-edit-info">
                <p><strong>üîÑ Reorganiza√ß√£o:</strong> Se voc√™ alterar a ordem para um n√∫mero j√° ocupado, os processos intermedi√°rios ser√£o reorganizados automaticamente.</p>
            </div>
            
            <form id="editProcessoForm">
                <input type="hidden" id="editProcessoId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="editProcessoNome">Nome do Processo:</label>
                        <input type="text" id="editProcessoNome" name="nome" required>
                    </div>
                    <div class="form-group ordem-input-container">
                        <label for="editProcessoOrdem">Ordem:</label>
                        <input type="number" id="editProcessoOrdem" name="ordem" min="1" required>
                        <div id="editOrdemFeedback" class="ordem-feedback"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="editProcessoDescricao">Descri√ß√£o:</label>
                    <textarea id="editProcessoDescricao" name="descricao" rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-cancel" onclick="closeEditProcessoModal()">Cancelar</button>
                    <button type="submit" class="btn-save">Salvar Altera√ß√µes</button>
                </div>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>